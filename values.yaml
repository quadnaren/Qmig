## Default values for qmig-chart.
## This is a YAML-formatted file.
## Declare variables to be passed into your templates.

## @param nameOverride String to partially override name template (will maintain the release name) Default: ""
nameOverride: ""

## @param clusterDomain Kubernetes Cluster Domain Default: "cluster.local"
clusterDomain: "cluster.local"

## Required global project information to be created in secret
secret:
  ## @param secret.secretName Name for project secret Default: "" (name: qmig-secret)
  secretName: ""
  ## @param secret.annotations Annotations for secrets Default: {}
  annotations: {}
  ## @param secret.labels Labels for secrets Default: {}
  labels: {}
  data:
    ## @param secret.data.PROJECT_ID ID of project Default: null
    PROJECT_ID: null
    ## @param secret.data.PROJECT_NAME Name of project Default: null
    PROJECT_NAME: null
    ## @param secret.data.POSTGRES_PASSWORD Admin Password for metadata DB Default: null
    POSTGRES_PASSWORD: null

## Required docker registry information to pull images from
imageCredentials:
  ## @param imageCredentials.enabled create docker pull secret Default: true
  create: true
  ## @param imageCredentials.secretName Name for docker secret Default: "" (name: qmig-docker)
  secretName: "" 
  ## @param imageCredentials.annotations Annotations for docker secret Default: {}
  annotations: {}
  ## @param imageCredentials.labels Labels for docker secret Default: {}
  labels: {}
  data:
    ## @param imageCredentials.data.registry Server/Registry host. Default: qmigrator.azurecr.io
    registry: null
    ## @param imageCredentials.data.username Username for given docker host Default: null
    username: null
    ## @param imageCredentials.data.password Password for given docker host Default: null
    password: null

## QMigrator shares PersistentVolume & information about the volume folders used by Airflow too
## @param shared.persistentVolume.enabled If false, use emptyDir Default: true
## @param shared.persistentVolume.accessModes How should the volume be accessible in App Default: ReadWriteMany
## @param shared.persistentVolume.annotations Persistent Volume Claim annotations Default: {}
## @param shared.persistentVolume.labels Labels for docker persistentVolume Default: {}
## @param shared.persistentVolume.existingClaim Name of PVC created manually before volume Default: ""
## @param shared.persistentVolume.subPath Subdirectory of data Persistent Volume to mount Default: ""
## @param shared.persistentVolume.size Persistent Volume size Default: 5Gi
## @param shared.persistentVolume.storageClass Persistent Volume Storage Class Default: "" (Default from Kubernetes)
## @param shared.persistentVolume.volumeBindingMode Persistent Volume Binding Mode Default: "" (Default from Kubernetes)
shared:
  persistentVolume:
    enabled: true

    ## Must match those of existing PV or dynamic provisioner
    ## Ref: http://kubernetes.io/docs/user-guide/persistent-volumes/
    accessModes:
      - ReadWriteMany

    ## data Persistent Volume Claim annotations
    annotations: {}
    ## data Persistent Volume Claim labels
    labels: {}

    ## Requires shared.persistentVolume.enabled: true
    ## If defined, PVC must be created manually before volume will be bound
    existingClaim: ""

    ## Subdirectory of data Persistent Volume to mount
    ## Useful if the volume's root directory is not empty
    subPath: ""

    ## data Persistent Volume size
    size: 5Gi

    ## data Persistent Volume Storage Class
    ## If defined, storageClassName: <storageClass>
    ## If set to "-", storageClassName: "", which disables dynamic provisioning
    ## If undefined (the default) or set to null, no storageClassName spec is
    ##   set, choosing the default provisioner.  (gp2 on AWS, standard on
    ##   GKE, AWS & OpenStack)
    storageClass: ""

    ## data Persistent Volume Binding Mode
    ## If defined, volumeBindingMode: <volumeBindingMode>
    ## If undefined (the default) or set to null, no volumeBindingMode spec is
    ##   set, choosing the default mode.
    volumeBindingMode: ""

## The Application requires the ingress to be exposed application
## Enable to quickly install controller within the helm
## https://kubernetes.github.io/ingress-nginx/deploy/
ingressController:
  ## @param ingressController.enabled Whether or not to install the ingressController Default: false
  enabled: false
  ## @param ingressController.provider The name of the ingressController provider either nginx-inc or kubernetes Default: kubernetes
  provider: "kubernetes"
  ## @param ingressController.name The name of the ingressController to use Default: "" (name: nginx-ingress)
  name: "nginx-ingress"
  ## @param ingressController.labels Labels for ingressController Default: {}
  labels: {}

  ## @param ingressController.controllerImage.repository Ingress controller image repository Default: qmigrator.azurecr.io/ingress-nginx/controller
  ## @param ingressController.controllerImage.tag Ingress controller image tag/version Default: "v1.9.4"
  controllerImage:
    repository: qmigrator.azurecr.io/ingress-nginx/controller
    tag: "v1.9.4"
  ## @param ingressController.webhookImage.repository Ingress controller image repository Default: qmigrator.azurecr.io/ingress-nginx/kube-webhook-certgen
  ## @param ingressController.webhookImage.tag Ingress controller image tag/version Default: "v20231011-8b53cabe0"
  webhookImage:
    repository: qmigrator.azurecr.io/ingress-nginx/kube-webhook-certgen
    tag: "v20231011-8b53cabe0"
  ## @param ingressController.image.repository Ingress image repository for Nginx Inc Default: nginx/nginx-ingress
  ## @param ingressController.image.tag Ingress image tag/version for Nginx Inc Default: "3.6.1"
  image:
    repository: nginx/nginx-ingress
    tag: "3.6.1"
  ## @param ingressController.imagePullSecrets Ingress Controller component pull secrets Default: {}
  ## Secrets must be manually created in the namespace.
  ## ref: https://kubernetes.io/docs/tasks/configure-pod-container/pull-image-private-registry/
  imagePullSecrets: {}

  ## @param ingressController.isDefaultClass Set Ingress class as default to cluster Default: true
  isDefaultClass: true

  ## @param ingressController.securityContexts.pod default security context for Ingress Controller pods Default: {}
  ## @param ingressController.securityContexts.container default security context for Ingress Controller containers Default: {}
  ## ref: https://kubernetes.io/docs/tasks/configure-pod-container/security-context/
  securityContexts:
    pod: {}
    container:
      allowPrivilegeEscalation: false
      runAsUser: 101
      runAsNonRoot: true
      capabilities:
        drop:
        - ALL
        add:
        - NET_BIND_SERVICE
  ## @param ingressController.tolerations Tolerations for Ingress Controller pods assignment Default: {}
  ## Ref: https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/
  tolerations: []
  ## @param ingressController.affinity Affinity for Ingress Controller pods assignment (evaluated as a template) Default: {}
  ## Ref: https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#affinity-and-anti-affinity
  affinity: {}
  ## @param ingressController.nodeSelector Node labels for Ingress Controller pods assignment Default: {}
  ## Ref: https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/
  nodeSelector: {}
  ## @param ingressController.resources Set container requests and limits for different resources like CPU or memory (essential for production workloads)
  resources:
    limits:
      cpu: 300m
      memory: 394Mi
    requests:
      cpu: 100m
      memory: 128Mi

## Qmigrator ingress parameters
## ref: https://kubernetes.io/docs/concepts/services-networking/ingress/
ingress:
  ## @param ingress.enabled Enable ingress record generation Default: true
  enabled: true
  ## @param ingress.className IngressClass that will be used to implement the Ingress (Kubernetes 1.18+) Default: "" (From Kubernetes)
  ## This is supported in Kubernetes 1.18+ and required if you have more than one IngressClass marked as the default for your cluster.
  ## ref: https://kubernetes.io/blog/2020/04/02/improvements-to-the-ingress-api-in-kubernetes-1.18/
  className: "nginx"
  ## @param ingress.annotations Additional annotations for the Ingress resource Default: {}
  annotations: {}
  ## @param ingress.labels Add labels for the Ingress Default: {}
  labels: {}
  ## @param ingress.host Default host for the ingress record Default: ""
  host: ""
  ## @param ingress.tls TLS configuration for additional hostname(s) to be covered with this ingress record Default: {}
  ## ref: https://kubernetes.io/docs/concepts/services-networking/ingress/#tls
  ## e.g:
  ## tls:
  ## - hosts:
  ##     - app.local
  ##   secretName: app.local-tls


## Service account for QMigrator pods to use.
## ref: https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/
serviceAccount:
  ## @param serviceAccount.create Enable creation of ServiceAccount Default: true
  create: true
  ## @param serviceAccount.name The name of the ServiceAccount to use Default: "" (name: qmig-opr)
  ## If not set and create is true, a name is generated default
  name: ""
  ## @param serviceAccount.annotations Additional custom annotations for the ServiceAccount Default: {}
  annotations: {}

  ## @param serviceAccount.labels Labels for ServiceAccount Default: {}
  labels: {}

## Enable RBAC (default on most clusters these days)
## Role Based Access
## Ref: https://kubernetes.io/docs/admin/authorization/rbac/
## @param rbac.create Create Role and RoleBinding Default: true
rbac:
  ## - if `false`, you must create a custom Role and RoleBinding for the ServiceAccount defined in `serviceAccount.name`
  create: true

## App component
## @param app.name Name for App component Default: "app"
## @param app.replicas Number of App Components replicas Default: 1
## @param app.image.repository App component image repository Default: "qmigrator.azurecr.io/qubeappv2"
## @param app.image.tag App component image tag/version Default: "ora2pg-134"
## @param app.image.pullPolicy App component pull policy Default: "IfNotPresent"
## @param app.imagePullSecrets App component pull secrets Default: {}
app:
  name: "admin-app"
  replicas: 1
  image:
    repository: qmigrator.azurecr.io/qubeadmin
    pullPolicy: IfNotPresent
    tag: "q142"

  imagePullSecrets: {}
   
  ## Configure extra options for App component containers' liveness and readiness
  ## ref: https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/#configure-probes
  ## @param app.readinessProbe.enabled Enable readinessProbe on App Component containers Default: true
  readinessProbe:
    enabled: "true"

  ## Configure extra options for App component containers' liveness and readiness
  ## ref: https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/#configure-probes
  ## @param app.livenessProbe.enabled Enable livenessProbe on App Component containers Default: true
  livenessProbe:
    enabled: "true"

  ## @param app.annotations Add extra annotations to the App Component Default: {}
  annotations: {}
  ## @param app.podAnnotations Add extra Pod annotations to the App Component pods Default: {}
  podAnnotations: {}
  ## @param app.securityContexts.pod default security context for App Component pods Default: {}
  ## @param app.securityContexts.container default security context for App Component containers Default: {}
  ## ref: https://kubernetes.io/docs/tasks/configure-pod-container/security-context/
  securityContexts:
    pod: {}
    container: {}
  ## @param app.tolerations Tolerations for App Component pods assignment Default: {}
  ## Ref: https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/
  tolerations: []
  ## @param app.affinity Affinity for App Component pods assignment (evaluated as a template) Default: {}
  ## Ref: https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#affinity-and-anti-affinity
  affinity: {}
  ## @param app.nodeSelector Node labels for App Component pods assignment Default: {}
  ## Ref: https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/
  nodeSelector: {}

  ## @param app.labels Labels for App Component Default: {}
  labels: {}

  ## App Component service parameters
  service:
    ## @param app.service.annotations Additional custom annotations for App Component service Default: {}
    annotations: {}
    ## @param app.service.type App Component service type Default: ClusterIP
    type: ClusterIP
    ## @param app.service.port App Component service HTTP port Default: 4200
    port: 4200

  ## @param app.resources Set container requests and limits for different resources like CPU or memory (essential for production workloads)
  resources:
    requests:
      cpu: 100m
      memory: 200Mi
    limits:
      cpu: 200m
      memory: 400Mi

  ## Enable HorizontalPodAutoscaler for App Component pods
  ## ref: https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/
  ## @param app.autoscaling.enabled Whether to enable horizontal pod autoscaler Default: true
  ## @param app.autoscaling.minReplicas Configure a minimum amount of pods Default: 1
  ## @param app.autoscaling.maxReplicas Configure a maximum amount of pods Default: 2
  ## @param app.autoscaling.targetCPUUtilizationPercentage Define the CPU target to trigger the scaling actions (utilization percentage) Default: 80
  ## @param app.autoscaling.targetMemoryUtilizationPercentage Define the memory target to trigger the scaling actions (utilization percentage) Default: 80
  autoscaling:
    enabled: true
    minReplicas: 1
    maxReplicas: 2
    targetCPUUtilizationPercentage: 80
    targetMemoryUtilizationPercentage: 80

## Engine component
## @param eng.name Name for Engine component Default: "eng"
## @param eng.replicas Number of Engine component replicas Default: 1
## @param eng.image.repository Engine component image repository Default: "qmigrator.azurecr.io/admineng"
## @param eng.image.tag Engine component image tag/version Default: "q1163"
## @param eng.image.pullPolicy Engine component pull policy Default: "IfNotPresent"
## @param eng.imagePullSecrets Engine component pull secrets Default: {}
eng:
  name: "admin-eng"
  replicas: 1
  image:
    repository: qmigrator.azurecr.io/admineng
    pullPolicy: IfNotPresent
    tag: "q1163"

  imagePullSecrets: {}

  ## Configure extra options for Engine component containers' liveness and readiness
  ## ref: https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/#configure-probes
  ## @param eng.readinessProbe.enabled Enable readinessProbe on Engine component containers Default: true
  readinessProbe:
    enabled: "true"

  ## Configure extra options for Engine component containers' liveness and readiness
  ## ref: https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/#configure-probes
  ## @param eng.livenessProbe.enabled Enable livenessProbe on Engine component containers Default: true
  livenessProbe:
    enabled: "true"

  ## @param eng.annotations Add extra annotations to the Engine component Default: {}
  annotations: {}
  ## @param eng.podAnnotations Add extra Pod annotations to the Engine component pods Default: {}
  podAnnotations: {}
  ## @param eng.securityContexts.pod default security context for Engine component pods Default: {}
  ## @param eng.securityContexts.container default security context for Engine component containers Default: {}
  ## ref: https://kubernetes.io/docs/tasks/configure-pod-container/security-context/
  securityContexts:
    pod: {}
    container: {}
  ## @param eng.tolerations Tolerations for Engine component pods assignment Default: {}
  ## Ref: https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/
  tolerations: []
  ## @param eng.affinity Affinity for Engine component pods assignment (evaluated as a template) Default: {}
  ## Ref: https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#affinity-and-anti-affinity
  affinity: {}
  ## @param eng.nodeSelector Node labels for Engine component pods assignment Default: {}
  ## Ref: https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/
  nodeSelector: {}

  ## @param eng.labels Labels for Engine Component Default: {}
  labels: {}

  ## Engine component service parameters
  service:
    ## @param eng.service.annotations Additional custom annotations for Engine component service Default: {}
    annotations: {} 
    ## @param eng.service.type Engine component service type Default: ClusterIP
    type: ClusterIP
    ## @param eng.service.port Engine component service HTTP port Default: 8080
    port: 8080
 
  ## @param eng.extraVolumeMounts Optionally specify an extra list of additional volumeMounts for all the Engine component pods Default: []
  extraVolumeMounts: []
  ## @param eng.extraVolumes Optionally specify an extra list of additional volumes for all the Engine component pods Default: []
  extraVolumes: []

  ## @param eng.resources Set container requests and limits for different resources like CPU or memory (essential for production workloads)
  resources:
    requests:
      cpu: 400m
      memory: 400Mi
    limits:
      cpu: 800m
      memory: 800Mi

  ## Enable HorizontalPodAutoscaler for Engine component pods
  ## ref: https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/
  ## @param eng.autoscaling.enabled Whether to enable horizontal pod autoscaler Default: true
  ## @param eng.autoscaling.minReplicas Configure a minimum amount of pods Default: 1
  ## @param eng.autoscaling.maxReplicas Configure a maximum amount of pods Default: 2
  ## @param eng.autoscaling.targetCPUUtilizationPercentage Define the CPU target to trigger the scaling actions (utilization percentage) Default: 80
  ## @param eng.autoscaling.targetMemoryUtilizationPercentage Define the memory target to trigger the scaling actions (utilization percentage) Default: 80
  autoscaling:
    enabled: true
    minReplicas: 1
    maxReplicas: 2
    targetCPUUtilizationPercentage: 80
    targetMemoryUtilizationPercentage: 80

  ## @param eng.env Add extra environment variables for the Engine component pods Default: []
  ## Example:
  ## env:
  ##  ENV_NAME: ENV_VALUE
  env: []

  ## @param eng.envSecret List of secrets with extra environment variables for all the component pods Default: []
  ## Example:
  ## envSecret:
  ##  - name: ENV_NAME
  ##    secretRef: SecretName
  ##    secretKey: SecretKey inside secret
  envSecret: []

## Metadata DB component
## @param db.name Name for DB component Default: "db"
## @param db.replicas Number of DB component replicas Default: 1
## @param db.strategy Update strategy for DB component pods Default: "Recreate"
## @param db.image.repository DB component image repository Default: "postgres" (hub.docker.com)
## @param db.image.tag DB component image tag/version Default: "14.2"
## @param db.image.pullPolicy DB component pull policy Default: "IfNotPresent"
## @param db.imagePullSecrets DB component pull secrets Default: {}
db:
  name: "admin-db"
  replicas: 1
  strategy: "Recreate"
  image:
    repository: postgres
    pullPolicy: IfNotPresent
    tag: "14.2"

  imagePullSecrets: {}

  ## @param db.dbshConfig.stringOverride Override shell script to be run on the initial time of DB Default: ""
  ## the full content of the `db-sh.sh` file (as a string)
  ##   stringOverride: |
  ##     #!/bin/bash
  ##     echo "Hello World"
  dbshConfig:
    stringOverride: ""

  ## @param db.annotations Add extra annotations to the DB component Default: {}
  annotations: {}
  ## @param db.podAnnotations Add extra Pod annotations to the DB component pods Default: {}
  podAnnotations: {}
  ## @param db.securityContexts.pod default security context for DB Component pods Default: {}
  ## @param db.securityContexts.container default security context for DB Component containers Default: {}
  ## ref: https://kubernetes.io/docs/tasks/configure-pod-container/security-context/
  securityContexts:
    pod: {}
    container: {}
  ## @param db.tolerations Tolerations for DB component pods assignment Default: {}
  ## Ref: https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/
  tolerations: []
  ## @param db.affinity Affinity for DB component pods assignment (evaluated as a template) Default: {}
  ## Ref: https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#affinity-and-anti-affinity
  affinity: {}
  ## @param db.nodeSelector Node labels for DB component pods assignment Default: {}
  ## Ref: https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/
  nodeSelector: {}

  ## @param db.labels Labels for DB Component Default: {}
  labels: {}

  ## Initialize the container of DB to load the db components
  ## @param db.initContainers.image.repository Load DB image repository Default: "qmigrator.azurecr.io/qmigdb-ini"
  ## @param db.initContainers.image.tag Load DB image tag/version Default: "1199-admmin"
  initContainer:
    loadDB:
      image:
        repository: qmigrator.azurecr.io/qmigdb-ini
        tag: "1199-admin"
      ## @param db.initContainers.resources Set Init container requests and limits for different resources like CPU or memory
      resources:
        requests:
          cpu: 100m
          memory: 200Mi
        limits:
          cpu: 200m
          memory: 400Mi
      imagePullSecrets: {}

  ## @param db.persistentVolume.enabled If false, use emptyDir Default: true
  ## @param db.persistentVolume.accessModes How should the volume accessible in App Default: ReadWriteOnce
  ## @param db.persistentVolume.annotations Persistent Volume Claim annotations Default: {}
  ## @param db.persistentVolume.existingClaim Name of PVC created manually before volume Default: ""
  ## @param db.persistentVolume.subPath Subdirectory of data Persistent Volume to mount Default: ""
  ## @param db.persistentVolume.size Persistent Volume size Default: 5Gi
  ## @param db.persistentVolume.storageClass Persistent Volume Storage Class Default: "" (Default from Kubernetes)
  ## @param db.persistentVolume.volumeBindingMode Persistent Volume Binding Mode Default: "" (Default from Kubernetes)
  persistentVolume:
    ## If false, use emptyDir
    enabled: true

    ## Must match those of existing PV or dynamic provisioner
    ## Ref: http://kubernetes.io/docs/user-guide/persistent-volumes/
    accessModes:
      - ReadWriteOnce

    ## data Persistent Volume Claim annotations
    annotations: {}

    ## Requires db.persistentVolume.enabled: true
    ## If defined, PVC must be created manually before volume will be bound
    existingClaim: ""

    ## Subdirectory of data Persistent Volume to mount
    ## Useful if the volume's root directory is not empty
    ## subPath: ""

    ## data Persistent Volume size
    size: 5Gi

    ## data Persistent Volume Storage Class
    ## If defined, storageClassName: <storageClass>
    ## If set to "-", storageClassName: "", which disables dynamic provisioning
    ## If undefined (the default) or set to null, no storageClassName spec is
    ##   set, choosing the default provisioner.  (gp2 on AWS, standard on
    ##   GKE, AWS & OpenStack)
    storageClass: ""

    ## data Persistent Volume Binding Mode
    ## If defined, volumeBindingMode: <volumeBindingMode>
    ## If undefined (the default) or set to null, no volumeBindingMode spec is
    ##   set, choosing the default mode.
    volumeBindingMode: ""

  ## DB component service parameters
  service:
    ## @param db.service.annotations Additional custom annotations for DB component service Default: {}
    annotations: {}
    ## @param db.service.type DB component service type Default: "ClusterIP"
    type: ClusterIP
    ## @param db.service.port DB component service HTTP port Default: 5432
    port: 5432

  ## @param db.resources Set container requests and limits for different resources like CPU or memory (essential for production workloads)
  resources:
    requests:
      cpu: 200m
      memory: 500Mi
    limits:
      cpu: 400m
      memory: 1000Mi

  ## @param db.env Add extra environment variables for the DB component pods Default: [JDBC_PARAMS]
  ## Example:
  ## env:
  ##  ENV_NAME: ENV_VALUE
  env:
    JDBC_PARAMS: "sslfactory=org.postgresql.ssl.NonValidatingFactory"

  ## @param db.envSecret List of secrets with extra environment variables for all the component pods Default: []
  ## Example:
  ## envSecret:
  ##  - name: ENV_NAME
  ##    secretRef: SecretName
  ##    secretKey: SecretKey inside secret
  envSecret: []
 
  ## @param db.extraVolumeMounts Optionally specify an extra list of additional volumeMounts for all the DB component pods Default: []
  extraVolumeMounts: [] 
  ## @param db.extraVolumes Optionally specify an extra list of additional volumes for all the DB component pods Default: []
  extraVolumes: []